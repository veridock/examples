# Makefile dla SVG Browser

.PHONY: help install run dev clean test format lint docker-build docker-run

# DomyÅ›lny cel
help:
	@echo "ğŸ¨ SVG Browser - DostÄ™pne komendy:"
	@echo ""
	@echo "  install     - Instalacja zaleÅ¼noÅ›ci przez Poetry"
	@echo "  install-pip - Instalacja zaleÅ¼noÅ›ci przez pip"
	@echo "  run         - Uruchomienie serwera (produkcja)"
	@echo "  dev         - Uruchomienie serwera (tryb debug)"
	@echo "  test        - Uruchomienie testÃ³w"
	@echo "  format      - Formatowanie kodu (black)"
	@echo "  lint        - Sprawdzenie kodu (flake8)"
	@echo "  clean       - Czyszczenie plikÃ³w tymczasowych"
	@echo "  docker-build- Budowanie obrazu Docker"
	@echo "  docker-run  - Uruchomienie w kontenerze"
	@echo "  package     - Tworzenie pakietu dystrybucyjnego"
	@echo ""

# Instalacja przez Poetry
install:
	@echo "ğŸ“¦ Instalowanie zaleÅ¼noÅ›ci przez Poetry..."
	poetry install

# Instalacja przez pip
install-pip:
	@echo "ğŸ“¦ Instalowanie zaleÅ¼noÅ›ci przez pip..."
	pip install -r requirements.txt
	pip install -e .

# Uruchomienie serwera (produkcja)
run:
	@echo "ğŸš€ Uruchamianie SVG Browser (produkcja)..."
	poetry run python svg_browser/app.py

# Uruchomienie serwera (tryb debug)
dev:
	@echo "ğŸ”§ Uruchamianie SVG Browser (tryb debug)..."
	@echo "DEBUG=True" > .env.local
	@cat .env >> .env.local 2>/dev/null || true
	DEBUG=True poetry run python svg_browser/app.py

# Uruchomienie przez pip
run-pip:
	@echo "ğŸš€ Uruchamianie SVG Browser przez pip..."
	python svg_browser/app.py

# Tworzenie testowych plikÃ³w SVG
create-test-files:
	@echo "ğŸ“ Tworzenie testowych plikÃ³w SVG..."
	mkdir -p test-svgs/graphics test-svgs/pwa test-svgs/metadata
	@echo "Testowe pliki zostanÄ… stworzone w katalogu test-svgs/"

# Formatowanie kodu
format:
	@echo "âœ¨ Formatowanie kodu..."
	poetry run black svg_browser/
	poetry run black *.py

# Sprawdzenie kodu
lint:
	@echo "ğŸ” Sprawdzanie kodu..."
	poetry run flake8 svg_browser/ --max-line-length=88 --extend-ignore=E203

# Testy
test:
	@echo "ğŸ§ª Uruchamianie testÃ³w..."
	poetry run pytest tests/ -v --cov=svg_browser

# Czyszczenie
clean:
	@echo "ğŸ§¹ Czyszczenie plikÃ³w tymczasowych..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	rm -rf build/ dist/ .coverage htmlcov/ .pytest_cache/
	rm -f .env.local

# Docker
docker-build:
	@echo "ğŸ³ Budowanie obrazu Docker..."
	docker build -t svg_browser .

docker-run:
	@echo "ğŸ³ Uruchamianie w kontenerze..."
	docker run -p 5000:5000 -v $(PWD)/.env:/app/.env svg_browser

# Tworzenie pakietu
package:
	@echo "ğŸ“¦ Tworzenie pakietu dystrybucyjnego..."
	poetry build

# Instalacja z pakietu
install-local:
	@echo "ğŸ“¦ Instalacja z lokalnego pakietu..."
	pip install dist/*.whl

# Sprawdzenie Å›rodowiska
check-env:
	@echo "ğŸ” Sprawdzanie Å›rodowiska..."
	@if [ ! -f .env ]; then echo "âŒ Brak pliku .env - skopiuj .env.example"; exit 1; fi
	@echo "âœ… Plik .env istnieje"
	@python -c "import sys; print(f'Python: {sys.version}')"
	@poetry --version 2>/dev/null || echo "Poetry: nie zainstalowane"

# PeÅ‚na instalacja i uruchomienie
setup: check-env install create-test-files
	@echo "âœ… Projekt gotowy do uÅ¼ycia!"
	@echo "Uruchom: make run"

# Pomoc rozszerzona
info:
	@echo "ğŸ¨ SVG Browser - Informacje o projekcie"
	@echo ""
	@echo "ğŸ“ Struktura projektu:"
	@echo "  svg_browser/        - Kod ÅºrÃ³dÅ‚owy"
	@echo "  svg_browser/app.py  - GÅ‚Ã³wny serwer"
	@echo "  templates/          - Szablony HTML"
	@echo "  .env                - Konfiguracja (skopiuj z .env.example)"
	@echo ""
	@echo "ğŸš€ Szybki start:"
	@echo "  1. make install"
	@echo "  2. cp .env.example .env"
	@echo "  3. # Edytuj .env i ustaw Å›cieÅ¼ki SCAN_PATHS"
	@echo "  4. make run"
	@echo ""
	@echo "ğŸŒ Serwer bÄ™dzie dostÄ™pny na: http://localhost:5000"